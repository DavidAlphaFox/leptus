#+AUTHOR:   Sina Samavati
#+EMAIL:    sina.samv@gmail.com
#+OPTIONS:  ^:nil toc:nil num:nil

* Leptus Documentation
  :PROPERTIES:
  :CUSTOM_ID: docs
  :END:

** Table of contents
   :PROPERTIES:
   :CUSTOM_ID: toc
   :END:

   - [[quick-overview][Quick Overview]]
   - [[types.org][Types]]

   - [[callbacks.org][Callbacks]]
     - [[callbacks.org#prefix0][prefix/0]]
     - [[callbacks.org#init3][init/3]]
     - [[callbacks.org#cross_domains3][cross_domains/3]]
     - [[callbacks.org#is_authenticated3][is_authenticated/3]]
     - [[callbacks.org#has_permission3][has_permission/3]]
     - [[callbacks.org#httpmethod3][HttpMethod/3]]
     - [[callbacks.org#terminate4][terminate/4]]

   - [[configuration.org][Configuration]]
     - [[configuration.org#handlers][handlers]]
     - [[configuration.org#options][options]]

   - Modules
     - [[leptus.org][leptus]]
     - [[leptus_config.org][leptus_config]]
     - [[leptus_logger.org][leptus_logger]]
     - [[leptus_router.org][leptus_router]]
     - [[leptus_utils.org][leptus_utils]]

** Quick Overview
   :PROPERTIES:
   :CUSTOM_ID: quick-overview
   :END:

   #+BEGIN_SRC erlang
   -module(hello).
   -compile({parse_transform, leptus_pt}).

   %% leptus callbacks
   -export([init/3]).
   -export([get/3]).
   -export([terminate/4]).

   init(_Route, _Req, State) ->
       {ok, State}.

   get("/", _Req, State) ->
       {<<"Hello, leptus!">>, State};
   get("/hi/:name", Req, State) ->
       Status = ok,
       Name = leptus_req:param(Req, name),
       Body = #{<<"say">> => <<"Hi">>, <<"to">> => Name},
       {Status, Body, State}.

   terminate(_Reason, _Route, _Req, _State) ->
       ok.
   #+END_SRC

   Note the use of the following in your request/resource handler module.
   #+BEGIN_SRC erlang
   -compile({parse_transform, leptus_pt}).
   #+END_SRC

   Let's compile, and run the example above.

   #+BEGIN_SRC
   $ erl -pa ebin deps/*/ebin
   #+END_SRC

   #+BEGIN_SRC
   > c(hello).
   > leptus:start_listener(http, [{'_', [{hello, undefined_state}]}]).
   Leptus started on http://127.0.0.1:8080
   #+END_SRC

   #+BEGIN_SRC
   $ curl localhost:8080/hi/Leptus
   {"say":"Hi","to":"Leptus"}
   #+END_SRC
